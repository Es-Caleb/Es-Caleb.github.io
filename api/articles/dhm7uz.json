{"title":"ubuntu 部署jenkins","uid":"bddf5d070a36a0f1beeaeeaa433a90bd","slug":"dhm7uz","date":"2021-12-10T03:10:00.000Z","updated":"2023-02-16T01:24:47.529Z","comments":true,"path":"api/articles/dhm7uz.json","keywords":null,"cover":[],"content":"<h1 id=\"服务器部署-jenkins\"><a href=\"#服务器部署-jenkins\" class=\"headerlink\" title=\"服务器部署 jenkins\"></a>服务器部署 jenkins</h1><h2 id=\"jenkinsci-blueocean-安装\"><a href=\"#jenkinsci-blueocean-安装\" class=\"headerlink\" title=\"jenkinsci/blueocean 安装\"></a>jenkinsci/blueocean 安装</h2><p><code>docker pull jenkinsci/blueocean</code></p>\n<h2 id=\"doker-部署-jenkins\"><a href=\"#doker-部署-jenkins\" class=\"headerlink\" title=\"doker 部署 jenkins\"></a>doker 部署 jenkins</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker run -d -u root --name jenkins -p <span class=\"token number\">8080</span>:8080 -p <span class=\"token number\">50000</span>:50000 -v /data/jenkins_home:/var/jenkins_home jenkinsci/blueocean:lts\n\ndocker run -d -u root --name jenkins -p <span class=\"token number\">8080</span>:8080 -p <span class=\"token number\">50000</span>:50000 -v /workspace/data/jenkins:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock -v /etc/timezone:/etc/timezone -v /etc/localtime:/etc/localtime jenkinsci/blueocean:1.25.1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"查看-Jenkins-启动情况\"><a href=\"#查看-Jenkins-启动情况\" class=\"headerlink\" title=\"查看 Jenkins 启动情况\"></a>查看 Jenkins 启动情况</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 查看启动项</span>\ndocker <span class=\"token function\">ps</span>\n<span class=\"token comment\"># 查看全部</span>\ndocker <span class=\"token function\">ps</span> -a<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><h3 id=\"Jenkins-容器-docker-run-之后状态-Exited\"><a href=\"#Jenkins-容器-docker-run-之后状态-Exited\" class=\"headerlink\" title=\"Jenkins 容器 docker run 之后状态 Exited\"></a>Jenkins 容器 docker run 之后状态 Exited</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 查看docker日志 ：</span>\ndocker logs jenkins\n发现是目前权限问题\n因为/data/jenkins_home 目录是root权限<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">chown</span> -R <span class=\"token number\">1000</span> /data/jenkins_home //用户组改变<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"Jenkins-首次登录需要密码\"><a href=\"#Jenkins-首次登录需要密码\" class=\"headerlink\" title=\"Jenkins 首次登录需要密码\"></a>Jenkins 首次登录需要密码</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">// 进入容器\ndocker <span class=\"token builtin class-name\">exec</span> -it de20d10b6046（容器id） <span class=\"token function\">bash</span>\n<span class=\"token function\">cat</span> /var/jenkins_home/secrets/initialAdminPassword //查看密码<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"jenkins-部署项目\"><a href=\"#jenkins-部署项目\" class=\"headerlink\" title=\"jenkins 部署项目\"></a>jenkins 部署项目</h1><h2 id=\"添加节点\"><a href=\"#添加节点\" class=\"headerlink\" title=\"添加节点\"></a>添加节点</h2><h3 id=\"进入容器-创建-ssh-证书-连接寄主机\"><a href=\"#进入容器-创建-ssh-证书-连接寄主机\" class=\"headerlink\" title=\"进入容器 创建 ssh 证书 连接寄主机\"></a>进入容器 创建 ssh 证书 连接寄主机</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 生成证书</span>\nssh-keygen -t rsa -C <span class=\"token string\">\"kingpi@163.com\"</span> -f ~/.ssh/host-rsa\n<span class=\"token comment\"># 进入.ssh</span>\n<span class=\"token builtin class-name\">cd</span> ~/.ssh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"添加-config\"><a href=\"#添加-config\" class=\"headerlink\" title=\"添加 config\"></a>添加 config</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">Host <span class=\"token number\">172.17</span>.0.1（寄主机docker ip）\n  HostName <span class=\"token number\">172.17</span>.0.1\n  User root\n  PreferredAuthentications publickey\n  IdentityFile ~/.ssh/host-rsa<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"寄主机进入-ssh\"><a href=\"#寄主机进入-ssh\" class=\"headerlink\" title=\"寄主机进入 ~/.ssh\"></a>寄主机进入 ~/.ssh</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> ~/.ssh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"进入文件-authorizedkeys\"><a href=\"#进入文件-authorizedkeys\" class=\"headerlink\" title=\"进入文件 authorizedkeys\"></a>进入文件 authorized<em>keys</em></h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> authorized_keys\n<span class=\"token comment\"># 输入 上面创建的 连接寄主机 ssh证书公钥</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h3 id=\"jenkins-添加-节点\"><a href=\"#jenkins-添加-节点\" class=\"headerlink\" title=\"jenkins 添加 节点\"></a>jenkins 添加 节点</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2021/png/12843443/1639905060247-d3efccf6-07ce-4c0a-a0c5-18ec83675637.png#clientId=u984dde43-e76a-4&from=paste&height=827&id=u55e900d0&name=image.png&originHeight=1654&originWidth=1500&originalType=binary&ratio=1&rotation=0&showTitle=false&size=201536&status=done&style=none&taskId=ue16f108e-3a9b-49df-bcd6-08e50d0d147&title=&width=750\" alt=\"image.png\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/12843443/1639148328357-e4a2e1fc-dfe2-44c0-9f91-7ce1b52c4250.png#clientId=uf90b85fc-dc9a-4&from=drop&id=u78cce22e&name=WeChatb3c23b7241c04b4d5134e43d23656cf8.png&originHeight=2848&originWidth=2456&originalType=binary&ratio=1&rotation=0&showTitle=false&size=687327&status=done&style=none&taskId=u6f0019ae-dea2-4eae-af76-3fbf9c2f624&title=\" alt=\"WeChatb3c23b7241c04b4d5134e43d23656cf8.png\"></p>\n<h2 id=\"jenkins-容器内创建连接-github-证书\"><a href=\"#jenkins-容器内创建连接-github-证书\" class=\"headerlink\" title=\"jenkins 容器内创建连接 github 证书\"></a>jenkins 容器内创建连接 github 证书</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ssh-keygen -t rsa -C <span class=\"token string\">\"kingpi@163.com\"</span> -f ~/.ssh/github.com\n<span class=\"token comment\"># config 添加host</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h3 id=\"jenkins-添加凭证-如上面-图\"><a href=\"#jenkins-添加凭证-如上面-图\" class=\"headerlink\" title=\"jenkins 添加凭证 如上面 图\"></a>jenkins 添加凭证 如上面 图</h3><h2 id=\"连接远程服务器\"><a href=\"#连接远程服务器\" class=\"headerlink\" title=\"连接远程服务器\"></a>连接远程服务器</h2><h3 id=\"jenkins-容器内创建证书\"><a href=\"#jenkins-容器内创建证书\" class=\"headerlink\" title=\"jenkins 容器内创建证书\"></a>jenkins 容器内创建证书</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ssh-keygen -t rsa -C <span class=\"token string\">\"kingpi@163.com\"</span> -m PEM -P <span class=\"token string\">\"\"</span> -f ~/.ssh/yooleap.net\n<span class=\"token comment\"># config 添加host</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h3 id=\"jenkins-系统配置配置服务器信息-添加上私钥\"><a href=\"#jenkins-系统配置配置服务器信息-添加上私钥\" class=\"headerlink\" title=\"jenkins 系统配置配置服务器信息 添加上私钥\"></a>jenkins 系统配置配置服务器信息 添加上私钥</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2021/png/12843443/1639905151450-e9034ac2-81fb-428b-b6f6-36978883d693.png#clientId=u984dde43-e76a-4&from=paste&height=499&id=u4481f8db&name=image.png&originHeight=998&originWidth=1182&originalType=binary&ratio=1&rotation=0&showTitle=false&size=117393&status=done&style=none&taskId=uda1e8286-f585-45a9-bff9-86651c4b5fd&title=&width=591\" alt=\"image.png\"></p>\n<h3 id=\"遇到的问题-1\"><a href=\"#遇到的问题-1\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 连接服务器测试报错</span>\njenkins.plugins.publish_over.BapPublisherException: Failed to <span class=\"token function\">add</span> SSH key. Message <span class=\"token punctuation\">[</span>invalid privatekey: <span class=\"token punctuation\">[</span>B@59df330d<span class=\"token punctuation\">]</span>_\n\n<span class=\"token comment\"># 解决方法</span>\n<span class=\"token function\">ssh</span> openSSH 版本过高 改用RSA\nssh-keygen -t rsa -C <span class=\"token string\">\"kingpi@163.com\"</span> -m PEM -P <span class=\"token string\">\"\"</span> -f ~/.ssh/yooleap.net<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","text":"服务器部署 jenkinsjenkinsci/blueocean 安装docker pull jenkinsci/blueocean doker 部署 jenkinsdocker run -d -u root --name jenkins -p 8080:8080 -p 5000...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"jenkins部署","slug":"jenkins部署","count":1,"path":"api/categories/jenkins部署.json"}],"tags":[{"name":"jenkins","slug":"jenkins","count":1,"path":"api/tags/jenkins.json"},{"name":"ubuntu","slug":"ubuntu","count":1,"path":"api/tags/ubuntu.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2-jenkins\"><span class=\"toc-text\">服务器部署 jenkins</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#jenkinsci-blueocean-%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">jenkinsci&#x2F;blueocean 安装</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#doker-%E9%83%A8%E7%BD%B2-jenkins\"><span class=\"toc-text\">doker 部署 jenkins</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B-Jenkins-%E5%90%AF%E5%8A%A8%E6%83%85%E5%86%B5\"><span class=\"toc-text\">查看 Jenkins 启动情况</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">遇到的问题</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Jenkins-%E5%AE%B9%E5%99%A8-docker-run-%E4%B9%8B%E5%90%8E%E7%8A%B6%E6%80%81-Exited\"><span class=\"toc-text\">Jenkins 容器 docker run 之后状态 Exited</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">解决方法</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Jenkins-%E9%A6%96%E6%AC%A1%E7%99%BB%E5%BD%95%E9%9C%80%E8%A6%81%E5%AF%86%E7%A0%81\"><span class=\"toc-text\">Jenkins 首次登录需要密码</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#jenkins-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE\"><span class=\"toc-text\">jenkins 部署项目</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B9\"><span class=\"toc-text\">添加节点</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8-%E5%88%9B%E5%BB%BA-ssh-%E8%AF%81%E4%B9%A6-%E8%BF%9E%E6%8E%A5%E5%AF%84%E4%B8%BB%E6%9C%BA\"><span class=\"toc-text\">进入容器 创建 ssh 证书 连接寄主机</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0-config\"><span class=\"toc-text\">添加 config</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%84%E4%B8%BB%E6%9C%BA%E8%BF%9B%E5%85%A5-ssh\"><span class=\"toc-text\">寄主机进入 ~&#x2F;.ssh</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E5%85%A5%E6%96%87%E4%BB%B6-authorizedkeys\"><span class=\"toc-text\">进入文件 authorizedkeys</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#jenkins-%E6%B7%BB%E5%8A%A0-%E8%8A%82%E7%82%B9\"><span class=\"toc-text\">jenkins 添加 节点</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#jenkins-%E5%AE%B9%E5%99%A8%E5%86%85%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5-github-%E8%AF%81%E4%B9%A6\"><span class=\"toc-text\">jenkins 容器内创建连接 github 证书</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#jenkins-%E6%B7%BB%E5%8A%A0%E5%87%AD%E8%AF%81-%E5%A6%82%E4%B8%8A%E9%9D%A2-%E5%9B%BE\"><span class=\"toc-text\">jenkins 添加凭证 如上面 图</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8\"><span class=\"toc-text\">连接远程服务器</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#jenkins-%E5%AE%B9%E5%99%A8%E5%86%85%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6\"><span class=\"toc-text\">jenkins 容器内创建证书</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#jenkins-%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF-%E6%B7%BB%E5%8A%A0%E4%B8%8A%E7%A7%81%E9%92%A5\"><span class=\"toc-text\">jenkins 系统配置配置服务器信息 添加上私钥</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98-1\"><span class=\"toc-text\">遇到的问题</span></a></li></ol></li></ol></li></ol>","author":{"name":"手可摘星陈","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"人就是这样，喜欢什么，败给什么","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"nginx配置","uid":"4298a08c1e0e68f5aeb283438517f755","slug":"xu9t5l","date":"2021-12-19T09:08:00.000Z","updated":"2023-02-16T01:24:47.531Z","comments":true,"path":"api/articles/xu9t5l.json","keywords":null,"cover":null,"text":"服务器 nginx 配置一般目录地址： /etc/nginx nginx.conf 配置示例# For more information on configuration, see: # * Official English Documentation: http://nginx...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"nginx","slug":"nginx","count":1,"path":"api/categories/nginx.json"}],"tags":[{"name":"nginx","slug":"nginx","count":1,"path":"api/tags/nginx.json"}],"author":{"name":"手可摘星陈","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"人就是这样，喜欢什么，败给什么","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"element-plus修改主题色","uid":"0e3cfafab513b2ddf7256c9eacf77c51","slug":"ual5ig","date":"2021-11-01T03:21:00.000Z","updated":"2023-02-16T01:24:47.531Z","comments":true,"path":"api/articles/ual5ig.json","keywords":null,"cover":null,"text":"先安装 vite 构建工具# 先安装 vite 构建工具 npm install -g create-vite-app 创建项目：# 下面两个命令都可以 create-vite-app vue3-demo cva vue3-demo 按照官网修改主题色官网我选择的是通过 scss...","link":"","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[{"name":"Vue","slug":"Vue","count":2,"path":"api/categories/Vue.json"}],"tags":[{"name":"vue3","slug":"vue3","count":4,"path":"api/tags/vue3.json"},{"name":"vue","slug":"vue","count":4,"path":"api/tags/vue.json"},{"name":"element-plus","slug":"element-plus","count":1,"path":"api/tags/element-plus.json"}],"author":{"name":"手可摘星陈","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"人就是这样，喜欢什么，败给什么","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}